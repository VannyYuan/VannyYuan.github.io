---
title: å·¥å…·æ¶ç•Œé¢å¼€å‘
tags: [Qt,Maya]
category: Qt
---

&emsp;&emsp;æœ€è¿‘æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯å¼€å‘å·¥å…·æ¶ï¼Œä¸»è¦åŠŸèƒ½ä¸ºå·¥å…·çš„æ˜¾ç¤ºå’Œç¼–è¾‘ã€‚ç”±äºè¿™æ¬¡å¼€å‘æ¶‰åŠæœªæ¥è§¦è¿‡çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šï¼Œè€Œä¸”å¯¹ç¾è§‚è®¾è®¡æ–¹é¢ä¹Ÿæœ‰æ‰€æ¬ ç¼ºï¼Œå› æ­¤å¼€å‘å‘¨æœŸæ¯”è¾ƒé•¿ï¼Œä½†æ”¶è·è‰¯å¤šã€‚

&emsp;&emsp;Qtæ˜¯è·¨å¹³å°çš„ï¼Œè™½ç„¶è¯¥å·¥å…·ä¸»è¦æ˜¯åœ¨ Maya ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯åŒæ ·å¯ä»¥æ‹“å±•åˆ°å…¶ä»–å¹³å°ä¸Šã€‚åœ¨å¼€å‘è¿™ä¸ªå·¥å…·çš„è¿‡ç¨‹ä¸­æ›´åŠ æ·±å…¥å­¦ä¹ äº† Qt çš„ MVC æ¡†æ¶ä»¥åŠå¯¹æ¥æ•°æ®åº“çš„ QSql ç›¸å…³çš„çŸ¥è¯†ï¼Œä¸‹é¢è¯¦ç»†è®²ä¸€ä¸‹è¿™ä¸ªå·¥å…·è¿‡ç¨‹å’Œæ¼”ç¤ºã€‚

---
# ğŸ™ å·¥å…·å±•ç¤º

## ç•Œé¢å±•ç¤º

- ç”¨æˆ·ç•Œé¢  
ç”¨æˆ·æ¨¡å¼ä¸»è¦è¿›è¡Œå·¥å…·çš„è°ƒç”¨ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/1.png)
- ç®¡ç†å‘˜ç•Œé¢  
ç®¡ç†å‘˜æ¨¡å¼ä¸»è¦è¿›è¡Œå·¥å…·çš„ç¼–è¾‘ï¼ŒåŠŸèƒ½åŒ…æ‹¬å·¥å…·çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€ç§»åŠ¨ã€æ”¹å˜åˆ†ç»„ã€‚ 
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/2.png)

---

## é€šç”¨åŠŸèƒ½

1. åˆ‡æ¢ç»„åˆ†ç±»  
é€šè¿‡ç‚¹å‡»ç»„é€‰é¡¹æ¡†ï¼Œé€‰æ‹©éœ€è¦åˆ‡æ¢çš„ç»„åï¼Œå³å¯æ›´æ”¹è§†å›¾ä¸­æ˜¾ç¤ºçš„å·¥å…·ä¸ºæ‰€é€‰ç»„å†…çš„å·¥å…·ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/14.gif)
1. æœç´¢å·¥å…·  
é€šè¿‡åœ¨æœç´¢æ¡†ä¸­è¾“å…¥éœ€è¦æœç´¢çš„å·¥å…·åç§°æˆ–å¤‡æ³¨ä¿¡æ¯ï¼Œå³å¯ä»è§†å›¾ä¸­ç­›é€‰ç¬¦åˆæœç´¢æ¡ä»¶çš„å·¥å…·å¹¶æ˜¾ç¤ºã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/15.gif)
1. åˆ‡æ¢ç”¨æˆ·æ¨¡å¼ä¸ç®¡ç†å‘˜æ¨¡å¼  
å¯ä»¥é€šè¿‡ç‚¹å‡»è®¾ç½®èœå•ä¸­çš„â€œè¿›å…¥ç”¨æˆ·/ç®¡ç†å‘˜æ¨¡å¼â€è¿›è¡Œå·¥å…·æ¨¡å¼åˆ‡æ¢ã€‚  
å½“å·¥å…·é¦–æ¬¡è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼æ—¶ä¼šè¦æ±‚è¾“å…¥å¯†ç ï¼Œåªæœ‰åœ¨å¯†ç è¾“å…¥æ­£ç¡®åæ‰èƒ½è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼ï¼Œåœ¨ä¸‹æ¬¡åˆå§‹åŒ–å·¥å…·å‰ä¸éœ€è¦é‡æ–°è¾“å…¥å¯†ç è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/17.gif)
1. æŠ˜å ç•Œé¢  
å¯ä»¥é€šè¿‡ç‚¹å‡»å·¥å…·å³ä¸Šè§’çš„ â€œ-â€ æŒ‰é’®ï¼ŒæŠŠç•Œé¢è¿›è¡ŒæŠ˜å æˆ–è€…å±•å¼€ã€‚æŠ˜å åçš„æ ‡é¢˜æ å¯ä»¥ç‚¹å‡»è¿›è¡Œæ‹–æ‹½ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/22.gif)
1. çª—å£æ‹–æ‹½  
å¯ä»¥åœ¨ç•Œé¢ç©ºç™½å¤„æŒ‰ä½é¼ æ ‡å·¦é”®å¹¶ç§»åŠ¨é¼ æ ‡ï¼Œå®ç°ç•Œé¢æ‹–æ‹½åŠŸèƒ½ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/23.gif)
1. çª—å£ç¼©æ”¾  
å¯ä»¥æŠŠé¼ æ ‡ç§»åŠ¨åˆ°çª—å£è¾¹ç¼˜ï¼Œå½“é¼ æ ‡å‡ºç°ç¼©æ”¾æ ·å¼æ—¶ï¼Œå¯ä»¥æŒ‰ä½é¼ æ ‡å·¦é”®å¹¶ç§»åŠ¨é¼ æ ‡ï¼Œå®ç°ç•Œé¢ç¼©æ”¾åŠŸèƒ½ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/24.gif)

---

## ç”¨æˆ·åŠŸèƒ½å±•ç¤º

1. åˆ‡æ¢è§†å›¾æ˜¾ç¤ºæ¨¡å¼  
åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå·¥å…·è§†å›¾æ˜¾ç¤ºæ¨¡å¼æœ‰åˆ—è¡¨æ˜¾ç¤ºå’Œå›¾æ ‡æ˜¾ç¤ºä¸¤ç§ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»è®¾ç½®èœå•ä¸Šçš„â€œåˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼â€ï¼Œå¯¹è§†å›¾çš„æ˜¾ç¤ºæ¨¡å¼è¿›è¡Œäº¤æ›¿æ›´æ¢ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/3.gif)
2. è°ƒèŠ‚è§†å›¾æ˜¾ç¤ºæ¯”ä¾‹  
åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€šè¿‡æ»‘åŠ¨è®¾ç½®èœå•ä¸Šçš„â€œè°ƒèŠ‚æ˜¾ç¤ºæ¯”ä¾‹â€çš„æ»‘åŠ¨æ¡ï¼Œå¯¹è§†å›¾çš„æ˜¾ç¤ºæ¯”ä¾‹è¿›è¡Œç¼©æ”¾ã€‚  
ä¸åŒæ˜¾ç¤ºæ¨¡å¼è§†å›¾çš„ç¼©æ”¾å€¼å®Œå…¨ç‹¬ç«‹ï¼Œè°ƒèŠ‚æ¯”ä¾‹æ—¶ä»…å¯¹å½“å‰æ˜¾ç¤ºæ¨¡å¼è§†å›¾ç”Ÿæ•ˆï¼Œä¸å½±å“å…¶ä»–æ˜¾ç¤ºæ¨¡å¼æ¯”ä¾‹ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/4.gif)
3. æŸ¥çœ‹å¤‡æ³¨  
åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨å·¥å…·ä¸Šï¼Œä¼šå¼¹å‡ºè¯¥å·¥å…·çš„å¤‡æ³¨ã€‚  
å¯¹äºè®¾ç½®äº†è¯´æ˜æ–‡æ¡£é“¾æ¥çš„å·¥å…·ï¼Œè¿˜å¯ä»¥ç‚¹å‡»â€œHelpâ€æ‰“å¼€è¯´æ˜é“¾æ¥ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/16.gif)
4. è¿è¡Œå·¥å…·  
&emsp;&emsp;å•å‡»ç”¨æˆ·ç•Œé¢ä¸­çš„å·¥å…·å³å¯è¿è¡Œé€‰ä¸­å·¥å…·ã€‚

---

## ç®¡ç†å‘˜åŠŸèƒ½å±•ç¤º

### ç¼–è¾‘å·¥å…·

1. åœ¨å½“å‰è¡Œå‰æ’å…¥å·¥å…·  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé€‰ä¸­å…¶ä¸­ä¸€è¡Œå·¥å…·ï¼Œç‚¹å‡»å›¾ç¤ºâ€œæ·»åŠ â€æŒ‰é’®ï¼Œå¯ä»¥åœ¨é€‰ä¸­è¡Œå‰æ’å…¥ä¸€è¡Œæ–°å·¥å…·ã€‚  
å¦‚æœå½“å‰ç»„ä¸æ˜¯ All ç»„ï¼Œåˆ›å»ºçš„å·¥å…·ä¼šè‡ªåŠ¨åŠ å…¥åˆ° All ç»„ä¸­ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/5.gif)
1. åˆ é™¤å½“å‰è¡Œçš„å·¥å…·  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé€‰ä¸­éœ€è¦ç§»é™¤çš„å·¥å…·ï¼Œç‚¹å‡»å›¾ç¤ºâ€œåˆ é™¤â€æŒ‰é’®ï¼Œå¯ä»¥åˆ é™¤é€‰ä¸­è¡Œçš„å·¥å…·ã€‚  
åˆ é™¤å·¥å…·ä¼šæŠŠå·¥å…·ä»æ‰€æœ‰ç»„ä¸­ç§»é™¤ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/6.gif)
3. ä¸Šç§»å½“å‰è¡Œ  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé€‰æ‹©éœ€è¦ä¸Šç§»çš„å·¥å…·è¡Œï¼Œç‚¹å‡»å›¾ç¤ºâ€œä¸Šç§»â€æŒ‰é’®ï¼Œå¯ä»¥æŠŠé€‰ä¸­å·¥å…·ä¸Šç§»ä¸€ä½ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/7.gif)
4. ä¸‹ç§»å½“å‰è¡Œ  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé€‰æ‹©éœ€è¦ä¸‹ç§»çš„å·¥å…·è¡Œï¼Œç‚¹å‡»å›¾ç¤ºâ€œä¸‹ç§»â€æŒ‰é’®ï¼Œå¯ä»¥æŠŠé€‰ä¸­å·¥å…·ä¸‹ç§»ä¸€ä½ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/8.gif)
5. æ‹–æ‹½ç§»åŠ¨è¡Œ  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé¼ æ ‡å·¦é”®æŒ‰ä½éœ€è¦æ‹–æ‹½ç§»åŠ¨çš„å·¥å…·è¡Œï¼ŒæŒ‰ä½æ‹–åŠ¨é¼ æ ‡åˆ°éœ€è¦æ’å…¥çš„è¡Œä½ç½®åæ¾å¼€é¼ æ ‡å·¦é”®ï¼Œå¯ä»¥æŠŠå·¥å…·ç§»åŠ¨åˆ°æŒ‡å®šè¡Œä½ç½®ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/13.gif)
6. ç¼–è¾‘å·¥å…·å†…å®¹  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œé¼ æ ‡å·¦é”®åŒå‡»é€‰ä¸­éœ€è¦ç¼–è¾‘çš„å†…å®¹ï¼Œå¯ä»¥ç¼–è¾‘å½“å‰å·¥å…·ã€‚å…¶ä¸­ ä½¿ç”¨æ¬¡æ•°ã€ tid å’Œ tdatetime ä¸ºä¸å¯ç¼–è¾‘åˆ—ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/21.gif)


### è¿è¡Œå·¥å…·å’Œæ‰“å¼€å·¥å…·å¸®åŠ©  

1. è¿è¡Œå·¥å…·  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œå³é”®ç‚¹å‡»é€‰ä¸­å·¥å…·ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œè¿è¡Œå·¥å…·â€ï¼Œå³å¯è¿è¡Œé€‰ä¸­å·¥å…·ã€‚  
2. æ‰“å¼€å¸®åŠ©  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œå³é”®ç‚¹å‡»é€‰ä¸­å·¥å…·ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œæ‰“å¼€å¸®åŠ©â€ï¼Œå³å¯æ‰“å¼€é€‰ä¸­å·¥å…·çš„å¸®åŠ©æ–‡æ¡£ã€‚  

### ä¿®æ”¹å·¥å…·çš„åˆ†ç»„

1. æ·»åŠ åˆ°ç»„  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œå³é”®ç‚¹å‡»é€‰ä¸­å·¥å…·ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œæ·»åŠ åˆ°ç»„â€ï¼Œå¼¹å‡ºåˆ—è¡¨ä¼šæ˜¾ç¤ºé™¤äº†å½“å‰ç»„ã€ All ç»„ä»¥åŠ Unsorted ç»„å¤–çš„å…¶ä»–ç»„ï¼Œé€‰æ‹©éœ€è¦æ·»åŠ çš„ç»„ï¼Œå¯ä»¥æŠŠé€‰ä¸­å·¥å…·æ·»åŠ åˆ°é€‰æ‹©çš„ç»„å†…ã€‚  
â€œæ·»åŠ åˆ°ç»„â€åŠŸèƒ½ä¸ä¼šæŠŠå·¥å…·ä»åŸæ¥çš„ç»„ä¸­ç§»é™¤ï¼Œè€Œæ˜¯ç›´æ¥åœ¨éœ€è¦æ·»åŠ çš„ç»„ä¸­æ·»åŠ è¯¥å·¥å…·ã€‚  
å‡å¦‚é€‰ä¸­å·¥å…·å·²ç»å­˜åœ¨äºéœ€è¦æ·»åŠ çš„ç»„ï¼Œåˆ™ä¼šè·³è¿‡æ·»åŠ æ“ä½œã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/18.gif)
2. ç§»åŠ¨åˆ°ç»„  
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œå³é”®ç‚¹å‡»é€‰ä¸­å·¥å…·ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œç§»åŠ¨åˆ°ç»„â€ï¼Œå¼¹å‡ºåˆ—è¡¨ä¼šæ˜¾ç¤ºé™¤äº†å½“å‰ç»„ã€ All ç»„ä»¥åŠ Unsorted ç»„å¤–çš„å…¶ä»–ç»„ï¼Œé€‰æ‹©éœ€è¦ç§»åŠ¨çš„ç»„ï¼Œå¯ä»¥æŠŠé€‰ä¸­å·¥å…·ç§»åŠ¨åˆ°é€‰æ‹©çš„ç»„å†…ã€‚  
â€œç§»åŠ¨åˆ°ç»„â€åŠŸèƒ½ä¼šæŠŠå·¥å…·ä»åŸæ¥ç»„ä¸­ç§»é™¤ï¼Œå¹¶åœ¨éœ€è¦ç§»åŠ¨çš„ç»„ä¸­æ·»åŠ è¯¥å·¥å…·ã€‚  
å‡å¦‚é€‰ä¸­å·¥å…·å·²ç»å­˜åœ¨äºéœ€è¦ç§»åŠ¨çš„ç»„ï¼Œåˆ™ä¼šè·³è¿‡æ·»åŠ æ“ä½œï¼Œä½†ä»ä¼šä»åŸæ¥ç»„ä¸­ç§»é™¤ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/19.gif)
3. ç§»å‡ºè¯¥ç»„
åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œå³é”®ç‚¹å‡»é€‰ä¸­å·¥å…·ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œç§»å‡ºè¯¥ç»„â€ï¼Œå¯ä»¥æŠŠå·¥å…·ä»å½“å‰ç»„ä¸­ç§»é™¤ã€‚  
ä¸â€œåˆ é™¤å·¥å…·â€ä¸åŒçš„æ˜¯ï¼Œâ€œåˆ é™¤å·¥å…·â€ä¼šæŠŠå·¥å…·ä»æ‰€æœ‰ç»„ä¸­åˆ é™¤ï¼Œè€Œâ€œç§»å‡ºè¯¥ç»„â€åªä¼šæŠŠå·¥å…·ä»è¯¥ç»„ä¸­ç§»é™¤ï¼Œè€Œä¸ä¼šå½±å“å·¥å…·åœ¨å…¶ä»–ç»„çš„å­˜åœ¨æƒ…å†µã€‚  
å‡å¦‚å·¥å…·åœ¨è¯¥ç»„ä¸­ç§»é™¤åä¸å­˜åœ¨äºé™¤äº† All ç»„å¤–çš„ä»»ä½•å…¶ä»–åˆ†ç»„ï¼Œåˆ™å·¥å…·ä¼šè‡ªåŠ¨æ·»åŠ åˆ° Unsorted åˆ†ç»„ä¸­ã€‚
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/20.gif)

### ç¼–è¾‘ç»„  

åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»â€œç¼–è¾‘ç»„â€æŒ‰é’®ï¼Œä¼šå¼¹å‡ºç¼–è¾‘ç»„çª—å£ç•Œé¢ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç•Œé¢ä¸­æŸ¥çœ‹åˆ°å·²ç»åˆ›å»ºçš„ç»„åï¼Œä»¥åŠè¿›è¡Œæ·»åŠ æ–°ç»„ã€åˆ é™¤ç»„å’Œé‡å‘½åç»„æ“ä½œã€‚ç¼–è¾‘ç»„ä¸­çš„ç»„ä¼šåŒæ­¥åˆ°å·¥å…·çš„åˆ†ç»„ä¸­ã€‚  
![](å·¥å…·æ¶ç•Œé¢å¼€å‘/9.gif)   
   1. æ·»åŠ æ–°ç»„  
   åœ¨æ‰“å¼€çš„ç¼–è¾‘ç»„çª—å£ä¸­ï¼Œç‚¹å‡»â€œæ·»åŠ ç»„â€æŒ‰é’®ï¼Œä¼šå¼¹å‡ºéœ€è¦è¾“å…¥æ–°ç»„åçš„çª—å£ï¼Œåœ¨çª—å£ä¸­è¾“å…¥éœ€è¦åˆ›å»ºçš„ç»„ååï¼Œç‚¹å‡»â€œOKâ€æŒ‰é’®ï¼Œå³å¯æŠŠåœ¨ç»„åˆ—è¡¨æœ€ä¸‹æ–¹åˆ›å»ºä¸€ä¸ªæ–°ç»„ã€‚  
   ![](å·¥å…·æ¶ç•Œé¢å¼€å‘/10.gif)
   2. åˆ é™¤ç»„  
   åœ¨æ‰“å¼€çš„ç¼–è¾‘ç»„çª—å£ä¸­ï¼Œé€‰æ‹©éœ€è¦åˆ é™¤çš„ç»„ï¼Œç‚¹å‡»â€œåˆ é™¤ç»„â€æŒ‰é’®ï¼Œä¼šå¼¹å‡ºæç¤ºæ¡†ï¼šâ€œç¡®å®šåˆ é™¤ xxx ç»„ï¼Ÿåˆ é™¤åæœªåˆ†ç±»å·¥å…·ä¼šç§»åŠ¨åˆ° Unsorted ç»„â€ã€‚ç‚¹å‡»æç¤ºæ¡†çš„â€œOkâ€æŒ‰é’®ï¼Œå³å¯åˆ é™¤é€‰ä¸­ç»„ã€‚  
   å‡å¦‚é€‰ä¸­ç»„ä¸­å­˜åœ¨å¤šä¸ªå·¥å…·ï¼Œåˆ™ä¼šåˆ¤æ–­æ¯ä¸ªå·¥å…·æ˜¯å¦å­˜åœ¨ä¸åˆ«çš„ç»„ä¸­ï¼Œå¦‚æœå·¥å…·ä¸å­˜åœ¨äºä»»ä½•ç»„ï¼ˆâ€œAllâ€ç»„é™¤å¤–ï¼‰ï¼Œåˆ™ä¼šæŠŠå·¥å…·ç§»åŠ¨åˆ° Unsorted æœªåˆ†ç±»ç»„ä¸­ã€‚  
   ![](å·¥å…·æ¶ç•Œé¢å¼€å‘/11.gif)
   3. é‡å‘½åç»„  
   åœ¨æ‰“å¼€çš„ç¼–è¾‘çª—å£ä¸­ï¼Œé€‰æ‹©éœ€è¦é‡å‘½åçš„ç»„ï¼Œç‚¹å‡»â€œé‡å‘½åç»„â€ï¼Œä¼šå¼¹å‡ºéœ€è¦è¾“å…¥æ–°ç»„åçš„çª—å£ï¼Œåœ¨çª—å£ä¸­è¾“å…¥æ–°ç»„ååï¼Œç‚¹å‡»â€œOkâ€æŒ‰é’®ï¼Œå³å¯æŠŠé€‰ä¸­ç»„é‡å‘½åã€‚  
   ![](å·¥å…·æ¶ç•Œé¢å¼€å‘/12.gif)

---

# ğŸ æ•°æ®ç»“æ„

## æ•°æ®åº“

&emsp;&emsp;æœ¬æ¥ä¸€å¼€å§‹æ˜¯è®¡åˆ’ç”¨ PostgreSQL æ¥å®ç°çš„ï¼Œä½†æ˜¯ç”±äº Maya çš„ PySide2 ä¸­æ²¡æœ‰ PSql çš„é©±åŠ¨ï¼Œæœ¬æ¥ä½¿ç”¨ PSql å·²ç»å¼€å‘ä¸€åŠäº†ï¼Œä¹Ÿæ— å¥ˆè¢«è¿«ä¸­æ­¢ï¼Œè½¬ç”¨ sqlite ã€‚

&emsp;&emsp;è‡³äº Model ï¼Œä¸€å¼€å§‹ä¸æ¸…æ¥š Qt æœ‰ç›´æ¥å¤„ç†æ•°æ®åº“çš„ç±»ï¼Œä½¿ç”¨äº†ä¼ ç»Ÿçš„ QAbstractTableModel ç»“åˆè‡ªå®šä¹‰ Node ç±»å‹èŠ‚ç‚¹å®ç°æ˜¾ç¤ºã€‚è™½ç„¶ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ•°æ®ï¼Œä½†æ˜¯åœ¨å¾—çŸ¥å¯ä»¥ä½¿ç”¨ QSqlTableModel ç›´æ¥æ“ä½œæ•°æ®åº“æ•°æ®åï¼Œå°±èˆå¼ƒäº†ä¼ ç»Ÿæ¨¡å‹ï¼Œæ”¹ç”¨ QSqlTableModel äº†ã€‚


### PSQL

&emsp;&emsp;è™½ç„¶æœ€ç»ˆå¹¶æ²¡æœ‰ä½¿ç”¨ Psql ï¼Œä½†æ˜¯æ¯•ç«ŸæŠ•å…¥äº†ä¸€ç‚¹æ—¶é—´è¿›è¡Œç ”ç©¶ï¼Œæ‰€ä»¥è¿˜æ˜¯è®°å½•ä¸€ä¸‹ Psql ä¸­çš„å¼€å‘ä½¿ç”¨å§ã€‚

#### åˆ›å»ºæ•°æ®åº“

&emsp;&emsp;ä½¿ç”¨ pgAdmin 4 åˆ›å»ºæ•°æ®åº“ã€‚

#### è·å–æ•°æ®åº“è¿æ¥

```Python
import psycopg2
conn = psycopg2.connect(
                database='database name',
                user='user name',
                password='database password',
                host='your host',
                port='your port')

TOOL_TABLE = 'public.tool_manager'
```

#### æ’å…¥æ•°æ®

```Python
def insert_data(conn, table, tname, tcommand, tlocation, ttooltip='',  tenabled=True, ticon='', thelp='', tgitlab='', tused=0, tid=0, tdatetime=''):
    cursor = conn.cursor()
    cursor.execute("INSERT INTO {}(tname, ttooltip, tcommand, tenabled, ticon, tlocation, thelp, tgitlab, tused, tid, tdate) \
        VALUES('{}', '{}', '{}', '{}', '{}', '{}', '{}', '{}', {}, {}, '{}')".format(
            table, tname, ttooltip.encode('utf-8'), tcommand, tenabled, ticon, tlocation, thelp, tgitlab, tused, tid, tdatetime
        ))

insert_data(conn, 'public.group_{}'.format(tgroups.lower().replace(' ','_')), tname=tname, tcommand=tcommand, tlocation=tlocation, ttooltip=ttooltip, ticon=ticon, tenabled=tenabled, thelp=thelp, tused=tused, tid=tid, tdatetime=tdatetime)
```

#### åˆ é™¤æ•°æ®

```python
def delete_data(conn, table, condition_key, condition_value):
    cursor = conn.cursor()
    cursor.execute("DELETE FROM {} \
        WHERE {}='{}'".format(table, condition_key, condition_value))

delete_data(conn, TOOL_TABLE, 'tname', 'first_tool')
```

#### æ¸…ç©ºè¡¨æ•°æ®

&emsp;&emsp;truncate æ–¹æ³•åœ¨ sqlite æ˜¯æ²¡æœ‰çš„ã€‚
```Python
def truncate_table(conn, table):
    cursor = conn.cursor()
    cursor.execute("truncate {}".format(table))

truncate_table(TOOL_TABLE)
```

#### æŸ¥è¯¢æ•°æ®

```Python
def query_data(conn, table, key, condition=''):
    cursor = conn.cursor()
    if condition:
        cursor.execute("SELECT {} from {} where {}".format(key, table, condition))
    else:
        cursor.execute("SELECT {} from {}".format(key, table))
    data = cursor.fetchall()
    return data

query_data(conn, TOOL_TABLE, 'tname')
```

#### æ›´æ–°æ•°æ®

```Python
def update_data(conn, table, key, value, condition):
    cursor = conn.cursor()
    try:
        cursor.execute("UPDATE {} SET {}='{}' WHERE {};".format(table, key, value.encode('utf-8'), condition))
    except:
        cursor.execute("UPDATE {} SET {}={} WHERE {};".format(table, key, value, condition))

update_data(conn, TOOL_TABLE, 'thelp', thelp, "tname='{}'".format(tname))
```

---

### SQlite

&emsp;&emsp;SQLite æ˜¯ä¸€ä¸ªè½¯ä»¶åº“ï¼Œå®ç°äº†è‡ªç»™è‡ªè¶³çš„ã€æ— æœåŠ¡å™¨çš„ã€é›¶é…ç½®çš„ã€äº‹åŠ¡æ€§çš„ SQL æ•°æ®åº“å¼•æ“ã€‚SQLite æ˜¯åœ¨ä¸–ç•Œä¸Šæœ€å¹¿æ³›éƒ¨ç½²çš„ SQL æ•°æ®åº“å¼•æ“ã€‚SQLite æºä»£ç ä¸å—ç‰ˆæƒé™åˆ¶ã€‚

#### åˆ›å»ºæ•°æ®åº“

&emsp;&emsp;SQLite å¯ä»¥æŒ‡å®šæ•°æ®åº“ä½ç½®ï¼Œå‡å¦‚ä½ç½®ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚
```Python
TOOLS_DB = 'tools.db'
conn = sqlite3.connect(TOOLS_DB)
cursor = conn.cursor()
```

#### åˆ›å»ºè¡¨

&emsp;&emsp;SQLite æ²¡æœ‰å•ç‹¬çš„ Boolean å­˜å‚¨ç±»ã€‚ç›¸åï¼Œå¸ƒå°”å€¼è¢«å­˜å‚¨ä¸ºæ•´æ•° 0ï¼ˆfalseï¼‰å’Œ 1ï¼ˆtrueï¼‰ã€‚

&emsp;&emsp;SQLite æ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ç”¨äºå­˜å‚¨æ—¥æœŸå’Œ/æˆ–æ—¶é—´çš„å­˜å‚¨ç±»ï¼Œä½† SQLite èƒ½å¤ŸæŠŠæ—¥æœŸå’Œæ—¶é—´å­˜å‚¨ä¸º TEXTã€REAL æˆ– INTEGER å€¼ã€‚

```Python
def create_table(table_name):
    cursor.execute('''select name from sqlite_master where type='table' order by name;''')
    table_tuples = cursor.fetchall()
    if tuple([table_name]) in table_tuples:
        return False
    cursor.execute('''create table {}(
        tname       text,
        ttooltip    text,
        tenabled    boolean,
        tsetup      boolean,
        tcommand    text,
        ticon       text,
        tlocation   text,
        thelp       text,
        tgitlab     text,
        tused       integer,
        tid         integer,
        tdate       text
        );'''.format(table_name))
    return True

create_table('group_all')
```

#### åˆ é™¤è¡¨

&emsp;&emsp;SQLite çš„ DROP TABLE è¯­å¥ç”¨æ¥åˆ é™¤è¡¨å®šä¹‰åŠå…¶æ‰€æœ‰ç›¸å…³æ•°æ®ã€ç´¢å¼•ã€è§¦å‘å™¨ã€çº¦æŸå’Œè¯¥è¡¨çš„æƒé™è§„èŒƒã€‚

&emsp;&emsp;ä½¿ç”¨æ­¤å‘½ä»¤æ—¶è¦ç‰¹åˆ«æ³¨æ„ï¼Œå› ä¸ºä¸€æ—¦ä¸€ä¸ªè¡¨è¢«åˆ é™¤ï¼Œè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯ä¹Ÿå°†æ°¸è¿œä¸¢å¤±ã€‚

```Python
def drop_table(table_name):
    cursor.execute('''DROP TABLE {};'''.format(table_name))

drop_table('group_all')
```

#### é‡å‘½åè¡¨å

```Python
def rename_table(old_table, new_table):
    cursor.execute('''select name from sqlite_master where type='table' order by name;''')
    table_tuples = cursor.fetchall()
    if tuple([new_table]) in table_tuples:
        return False
    cursor.execute('''ALTER TABLE {} RENAME TO {};'''.format(old_table, new_table))
    return True

rename_table('old', 'new')
```

#### æ¸…ç©ºè¡¨

&emsp;&emsp;åœ¨ SQLite ä¸­ï¼Œå¹¶æ²¡æœ‰ TRUNCATE TABLE å‘½ä»¤ï¼Œä½†å¯ä»¥ä½¿ç”¨ SQLite çš„ DELETE å‘½ä»¤ä»å·²æœ‰çš„è¡¨ä¸­åˆ é™¤å…¨éƒ¨çš„æ•°æ®ã€‚

```Python
def truncate_table(table):
    cursor.execute('''delete from {};'''.format(table))

truncate_table('group_all')
```

#### æ’å…¥æ•°æ®

```Python
def insert_record(table, tname='NewTool', tcommand='<Command>', tlocation='<Location>', ttooltip='<ToolTip>',  tenabled=True, ticon='<Icon>', thelp='<Help>', tgitlab='<Gitlab>', tused=0, tid=0, tdate='', tsetup=False):
    cursor.execute('''insert into {}(tname, ttooltip, tenabled, tsetup, tcommand, ticon, tlocation, thelp, tgitlab, tused, tid, tdate)
        VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?
        )'''.format(table), (tname, ttooltip, tenabled, tsetup, tcommand, ticon, tlocation, thelp, tgitlab, tused, tid, tdate))

insert_record('group_{}'.format(tgroups.lower().replace(' ','_')), tname=tname, tcommand=tcommand, tlocation=tlocation, ttooltip=ttooltip, ticon=ticon, tenabled=tenabled, thelp=thelp, tused=tused, tid=tid, tdate=tdatetime, tsetup=tsetup)
```

---

## QSqlTableModel

&emsp;&emsp;QSqlTableModel å¯ä»¥ä½œä¸º QTableView çš„æ•°æ®æºã€‚

### è¿æ¥æ•°æ®åº“

```Python
TOOLS_DB = 'tools.db'
@staticmethod
def sql_db():
    if QSqlDatabase.contains("qt_sql_default_connection"):
        db = QSqlDatabase.database("qt_sql_default_connection")
    else:
        db = QSqlDatabase.addDatabase("QSQLITE")
        
    db.setDatabaseName(TOOLS_DB)

    if db.open():
        return db
    else:
        return QSqlDatabase()
```

### è®¾ç½®ç¼–è¾‘ç­–ç•¥
QSqlTableModel.setEditStrategy(strategy)

å‚æ•°ä¸ºæšä¸¾ç±»å‹ï¼š
- OnFieldChange å­—æ®µå€¼å˜åŒ–æ—¶ç«‹å³æ›´æ–°åˆ°æ•°æ®åº“
- OnRowChange å½“å‰è¡Œå˜åŒ–æ—¶æ›´æ–°åˆ°æ•°æ®åº“
- OnManualSubmitÂ  æ‰€æœ‰ä¿®æ”¹æš‚æ—¶ç¼“å­˜ï¼Œæ‰‹åŠ¨è°ƒç”¨submitAllä¿å­˜

```Python
self.setEditStrategy(QSqlTableModel.OnManualSubmit)
```

---

# â­ å…·ä½“åŠŸèƒ½è¯¦è§£

## MVC æ¡†æ¶ æ˜¾ç¤ºå·¥å…·æ•°æ®

&emsp;&emsp;ç»å…¸ MVC æ¨¡å¼ä¸­ï¼ŒM æ˜¯æŒ‡ä¸šåŠ¡æ¨¡å‹ï¼ŒV æ˜¯æŒ‡ç”¨æˆ·ç•Œé¢ï¼ŒC åˆ™æ˜¯æ§åˆ¶å™¨ï¼Œä½¿ç”¨ MVC çš„ç›®çš„æ˜¯å°† M å’Œ V çš„å®ç°ä»£ç åˆ†ç¦»ï¼Œä»è€Œä½¿åŒä¸€ä¸ªç¨‹åºå¯ä»¥ä½¿ç”¨ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚å…¶ä¸­ï¼ŒView çš„å®šä¹‰æ¯”è¾ƒæ¸…æ™°ï¼Œå°±æ˜¯ç”¨æˆ·ç•Œé¢ã€‚

&emsp;&emsp;åœ¨ Qt ä¸­çš„ MVC å¹¶ä¸å«MVCï¼Œè€Œæ˜¯å«â€œMVDâ€ï¼ŒQtä¸­æ²¡æœ‰ Controller çš„è¯´æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å¦å¤–ä¸€ç§æŠ½è±¡: Delegate (å§”æ‰˜) ï¼Œå…¶è¡Œä¸ºå’Œä¼ ç»Ÿçš„ MVC æ˜¯ç›¸åŒçš„ã€‚

&emsp;&emsp;åœ¨æœ¬å·¥å…·ä¸­ï¼ŒView ä½¿ç”¨äº† QListViewï¼ˆç”¨æˆ·ç•Œé¢ï¼‰å’Œ QTableViewï¼ˆç®¡ç†å‘˜ç•Œé¢ï¼‰ï¼ŒModel ä½¿ç”¨äº† QSqlTableModelï¼ŒDelegate ä½¿ç”¨äº† QStyledItemDelegateï¼ˆcombobox æ˜¾ç¤º dataï¼‰ã€‚

### å·¥å…·è§†å›¾ ToolView

&emsp;&emsp;ç»§æ‰¿æ¶æ„ï¼š

![](å·¥å…·æ¶ç•Œé¢å¼€å‘/ToolViewç»§æ‰¿å›¾.jpg)

### æ•°æ®æ¨¡å‹ sqlTableModel

&emsp;&emsp;æ¨¡å‹æ–¹æ³•ï¼š

![](å·¥å…·æ¶ç•Œé¢å¼€å‘/sqlTableModelç»§æ‰¿å›¾.jpg)

### å§”æ‰˜ä»£ç† ComboBoxDelegate

&emsp;&emsp;å¯¹ tenabledã€tsetup è¿™ç±»å¸ƒå°”å€¼é¡¹è®¾ç½®ä»£ç†ï¼Œä½¿å¾—ç¼–è¾‘æ—¶æ˜¾ç¤ºè‡ªå®šä¹‰ä¸‹æ‹‰æ¡†ä»¥é€‰æ‹©â€œYesâ€æˆ–è€…â€œNoâ€ã€‚

![](å·¥å…·æ¶ç•Œé¢å¼€å‘/ComboBoxDelegateç»§æ‰¿å›¾.jpg)

### ä¸ºè§†å›¾è®¾ç½®æ¨¡å‹å’Œä»£ç†
ui_main_sql.py
```Python
# init list view
self.UserView = self.icon_list_view
self.tool_view = self.UserView
# init model
self.tool_model = _sql_table_model.sqlTableModel(self.tool_view)
# set list view model
self.icon_list_view.setModel(self.tool_model)
self.list_list_view.setModel(self.tool_model)

# --- change to AdminMode --- 
# init table view
self.AdminView = _table_view.TableView(self)
# init combobox delegate
combo_model = QStandardItemModel(2, 1, self.AdminView)
combo_model.setData(combo_model.index(0, 0, QModelIndex()), "Yes")
combo_model.setData(combo_model.index(1, 0, QModelIndex()), "No")
# set table view delegate
self.AdminView.setItemDelegateForColumn(self.tool_model._column_key['tenabled'], _combobox_delegate.ComboBoxDelegate(combo_model, self.AdminView))
self.AdminView.setItemDelegateForColumn(self.tool_model._column_key['tsetup'], _combobox_delegate.ComboBoxDelegate(combo_model, self.AdminView))
# set table view model
self.AdminView.setModel(self.tool_model)
```
---

## åˆ‡æ¢ç»„æ—¶æ›´æ–°å·¥å…·è§†å›¾

&emsp;&emsp;å½“åˆ‡æ¢ç»„æ—¶ï¼ŒsqkTableModelé‡æ–°è®¾ç½®æ•°æ®è¡¨ã€‚

ui_main_sql.py
```Python
class ToolWin(QMainWindow):
    def __init__(self, parent=None):
        # init group combobox
        self.group_combobox = _combo_box.ComboBox(self.group_list)
        # parse group combobox to model
        self.tool_model.set_group_combobox(self.group_combobox)
        # set group combobox signal
        self.group_combobox.currentTextChanged.connect(self.change_group)

    def change_group(self, cur_group):
        group_table = _table_view.TableView.group_to_table(cur_group)
        self.tool_model.change_db_table(group_table)
```

sql_table_model.py
```Python
class sqlTableModel(QSqlTableModel):
    def change_db_table(self, table_name):
        """æ›´å˜å½“å‰æ•°æ®åº“è¡¨ä¸ºæŒ‡å®šæ–°è¡¨å

        Args:
            table_name (str): æ•°æ®åº“è¡¨å
        """
        self.setTable(table_name)
        # é‡æ–°ç­›é€‰ç¬¦åˆæœç´¢æ¡ä»¶çš„å·¥å…·
        self.setFilter("lower(tname) like '%{}%' or lower(ttooltip) like '%{}%'".format(self._filter_text.lower(), self._filter_text.lower()))
        self.setSort(self._sort_key, Qt.AscendingOrder)
        self.select()

        self.setHeaderData(self._column_key['tname'], Qt.Horizontal, u"å·¥å…·åç§°")
        self.setHeaderData(self._column_key['ttooltip'], Qt.Horizontal, u"è¯´æ˜")
        self.setHeaderData(self._column_key['tcommand'], Qt.Horizontal, u"è°ƒç”¨å‘½ä»¤")
        self.setHeaderData(self._column_key['tenabled'], Qt.Horizontal, u"å¯è§æ€§")
        self.setHeaderData(self._column_key['tsetup'], Qt.Horizontal, u"å¯åŠ¨æ—¶è°ƒç”¨")
        self.setHeaderData(self._column_key['ticon'], Qt.Horizontal, u"å›¾æ ‡")
        self.setHeaderData(self._column_key['tlocation'], Qt.Horizontal, u"è°ƒç”¨ä½ç½®")
        self.setHeaderData(self._column_key['thelp'], Qt.Horizontal, u"å¸®åŠ©æ–‡æ¡£")
        self.setHeaderData(self._column_key['tgitlab'], Qt.Horizontal, u"Gitlabä»“åº“")
        self.setHeaderData(self._column_key['tused'], Qt.Horizontal, u"ä½¿ç”¨æ¬¡æ•°")

        # è®¾ç½®ç»„ä¸‹æ‹‰æ¡†å½“å‰å€¼ä¸ºæ–°è¡¨åå¯¹åº”çš„ç»„å
        if self._group_combobox:
            cur_table_group = self._parent_view.table_to_group(table_name)
            if not cur_table_group == self._group_combobox.currentText():
                self._group_combobox.setCurrentText(cur_table_group)

        # è¡¨æ ¼æ ¹æ®è®°å½•çš„tdateé€‰æ‹©å·¥å…·
        if self._parent_view.inherits('QTableView'):
            self._parent_view.setColumnWidth(self._column_key['tname'], 150)
            self.set_select_row()
```

---

## æ— è¾¹æ¡†çª—å£æ·»åŠ é˜´å½±

&emsp;&emsp;æŠŠé˜´å½±çª—å£ ShadowWidget è®¾ç½®ä¸ºæ˜¾ç¤ºä¸»çª—å£çš„çˆ¶çª—ä½“ã€‚

ui_main_sql.py
```Python
class ShadowWidget(QWidget):
    def __init__(self, main_win, parent=None):
        super(ShadowWidget, self).__init__(parent)

        self.setWindowFlags(Qt.FramelessWindowHint | Qt.Windo
        self.setAttribute(Qt.WA_TranslucentBackground)

        self.main_widget = main_win
        self.main_widget.setParent(self)
        self.main_layout = QVBoxLayout(self)
        self.main_layout.addWidget(self.main_widget)
        self.main_layout.setContentsMargins(6,6,6,6)

        wndShadow = QGraphicsDropShadowEffect(self)
        wndShadow.setBlurRadius(20)
        wndShadow.setColor(Qt.gray)
        wndShadow.setOffset(0,0)
        self.main_widget.setGraphicsEffect(wndShadow)
```
---

## æ— è¾¹æ¡†çª—å£æ‹–æ‹½åŠŸèƒ½

&emsp;&emsp;é€šè¿‡é‡å†™é¼ æ ‡ç‚¹å‡»ã€é‡Šæ”¾å’Œç§»åŠ¨äº‹ä»¶å®ç°çª—å£æ‹–æ‹½åŠŸèƒ½ã€‚

&emsp;&emsp;ç”¨ ismoving å±æ€§è®°å½•çª—å£ç§»åŠ¨çŠ¶æ€ã€‚

ui_main_sql.py
```Python
class ShadowWidget(QWidget):
    def __init__(self, main_win, parent=None):
        self.ismoving = False
        self.main_widget.setMouseTracking(True)
        self.setMouseTracking(True)
    
    def mouseMoveEvent(self, event):
        super(ShadowWidget, self).mouseMoveEvent(event)
        if self.ismoving:
            relpos = event.globalPos() - self.start_point
            self.move(self.window_point + relpos)

    def mousePressEvent(self, event):
        super(ShadowWidget, self).mousePressEvent(event)
        if event.button() == Qt.LeftButton:
            self.ismoving = True
            self.setCursor(Qt.ClosedHandCursor)
            self.start_point = event.globalPos()
            self.window_point = self.frameGeometry().topLeft()

    def mouseReleaseEvent(self, event):
        super(ShadowWidget, self).mouseReleaseEvent(event)
        self.ismoving = False
        if event.button() == Qt.LeftButton:
            self.setCursor(Qt.ArrowCursor)
```

---

## æ— è¾¹æ¡†çª—å£ç¼©æ”¾åŠŸèƒ½

å±æ€§ï¼š
- Margins: åˆ¤å®šçª—å£è¾¹ç¼˜è·ç¦»é¼ æ ‡çš„å€¼
- current_edit_rect: é¼ æ ‡æ‰€åœ¨ç•Œé¢çš„åŒºåŸŸèŒƒå›´
- on_left_btnï¼šæ˜¯å¦æŒ‰ä¸‹å·¦é”®

æ–¹æ³•ï¼š
- judgeReigon(pos): åˆ¤æ–­é¼ æ ‡åœ¨çª—å£è¾¹ç¼˜çš„å“ªä¸€éƒ¨åˆ†åŒºåŸŸ
- resizeWin(mgPos): é¼ æ ‡åœ¨å¯ä»¥ç¼©æ”¾çš„åŒºåŸŸèŒƒå›´å¹¶å·¦é”®ç‚¹å‡»å’Œæ‹–æ‹½ï¼Œåˆ™è¿›è¡Œç¼©æ”¾

ui_main_sql.py
```Python
class ShadowWidget(QWidget):
    def __init__(self, main_win, parent=None):
        self.Margins = 10
        self.current_edit_rect = None
        self.on_left_btn = False
        self.main_widget.setMouseTracking(True)
        self.setMouseTracking(True)

    def mouseMoveEvent(self, event):
        super(ShadowWidget, self).mouseMoveEvent(event)
        if not self.on_left_btn:
            self.judgeReigon(self.mapToParent(event.pos()))
        elif self.cursor() != Qt.ArrowCursor:
            self.resizeWin(event.globalPos())

    def mousePressEvent(self, event):
        super(ShadowWidget, self).mousePressEvent(event)
        if event.button() == Qt.LeftButton:
            self.on_left_btn = True
    
    def mouseReleaseEvent(self, event):
        super(ShadowWidget, self).mouseReleaseEvent(event)
        if event.button() == Qt.LeftButton:
            self.setCursor(Qt.ArrowCursor)
            self.current_edit_rect = None
            self.on_left_btn = False

    def judgeReigon(self, pos):
        rect = self.frameGeometry()

        self.top_rect = QRect(rect.x()+self.Margins, rect.y(), rect.width()-self.Margins*2, self.Margins)
        self.top_left_rect = QRect(rect.x(), rect.y(), self.Margins, self.Margins)
        self.left_rect = QRect(rect.x(), rect.y()+self.Margins, self.Margins, rect.height()-self.Margins*2)
        self.bottom_left_rect = QRect(rect.x(), rect.y()+rect.height()-self.Margins, self.Margins, self.Margins)
        self.bottom_rect = QRect(rect.x()+self.Margins, rect.y()+rect.height()-self.Margins, rect.width()-self.Margins*2, self.Margins)
        self.botton_right_rect = QRect(rect.x()+self.width()-self.Margins, rect.y()+rect.height()-self.Margins, self.Margins, self.Margins)
        self.right_rect = QRect(rect.x()+self.width()-self.Margins, rect.y()+self.Margins, self.Margins, rect.height()-self.Margins*2)
        self.top_right_rect = QRect(rect.x()+self.width()-self.Margins, rect.y(), self.Margins, self.Margins)

        if self.top_rect.contains(pos):
            self.setCursor(Qt.SizeVerCursor)
            self.current_edit_rect = 'top_rect'
        elif self.top_left_rect.contains(pos):
            self.setCursor(Qt.SizeFDiagCursor)
            self.current_edit_rect = 'top_left_rect'
        elif self.left_rect.contains(pos):
            self.setCursor(Qt.SizeHorCursor)
            self.current_edit_rect = 'left_rect'
        elif self.bottom_left_rect.contains(pos):
            self.setCursor(Qt.SizeBDiagCursor)
            self.current_edit_rect = 'bottom_left_rect'
        elif self.bottom_rect.contains(pos):
            self.setCursor(Qt.SizeVerCursor)
            self.current_edit_rect = 'bottom_rect'
        elif self.botton_right_rect.contains(pos):
            self.setCursor(Qt.SizeFDiagCursor)
            self.current_edit_rect = 'botton_right_rect'
        elif self.right_rect.contains(pos):
            self.setCursor(Qt.SizeHorCursor)
            self.current_edit_rect = 'right_rect'
        elif self.top_right_rect.contains(pos):
            self.setCursor(Qt.SizeBDiagCursor)
            self.current_edit_rect = 'top_right_rect'
        else:
            self.setCursor(Qt.ArrowCursor)
            self.current_edit_rect = None

    def resizeWin(self, mgPos):
        if self.current_edit_rect == None:
            return
        winX = self.geometry().x()
        winY = self.geometry().y()
        winW = self.geometry().width()
        winH = self.geometry().height()
        downside = self.pos().y() + winH
        rightside = self.pos().x() + winW
        if self.current_edit_rect == 'top_rect':
            winY = mgPos.y()
            winH = downside - winY
        elif self.current_edit_rect == 'top_left_rect':
            winY = mgPos.y()
            winH = downside - winY
            winX = mgPos.x()
            winW = rightside - winX
        elif self.current_edit_rect == 'left_rect':
            winX = mgPos.x()
            winW = rightside - winX
        elif self.current_edit_rect == 'bottom_left_rect':
            winX = mgPos.x()
            winW = rightside - winX
            winH = mgPos.y() - self.pos().y()
        elif self.current_edit_rect == 'botton_right_rect':
            winW = mgPos.x() - self.pos().x()
            winH = mgPos.y() - self.pos().y()
        elif self.current_edit_rect == 'right_rect':
            winW = mgPos.x() - self.pos().x()
        elif self.current_edit_rect == 'bottom_rect':
            winH = mgPos.y() - self.pos().y()
        elif self.current_edit_rect == 'top_right_rect':
            winY = mgPos.y()
            winH = downside - winY
            winW = mgPos.x() - self.pos().x()
        if winW < self.win_min_width:
            return
        if winH < self.win_min_height:
            return
        self.setGeometry(winX, winY, winW, winH)
```
---

## çª—å£åº”ç”¨ç”¨æˆ·é…ç½®

### å…³é—­æ—¶ä¿å­˜é…ç½®ä¿¡æ¯

&emsp;&emsp;å½“å·¥å…·å…³é—­æˆ–è€…é€€å‡ºæ—¶ï¼Œä¼šåœ¨ç”µè„‘æœ¬åœ°æ–‡æ¡£è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªâ€œpopic_tool_config.jsonâ€æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶è®°å½•å·¥å…·çª—å£çš„ä½ç½®ã€å¤§å°ã€ç”¨æˆ·/ç®¡ç†å‘˜æ¨¡å¼ã€å½“å‰åˆ—è¡¨è§†å›¾æ˜¾ç¤ºæ¨¡å¼ã€å·¥å…·ç¼©æ”¾æ»‘å—æ¡æ•°å€¼å’Œå½“å‰æ˜¾ç¤ºç»„çš„ä¿¡æ¯ã€‚

```Python
USER_CONFIG_PATH = os.path.expanduser('~/popic_tool_config.json')

class ShadowWidget(QWidget):
    def closeEvent(self, event):
        super(ShadowWidget, self).closeEvent(event)
        user_config = {
            'win_left' : self.pos().x(),
            'win_top' : self.pos().y(),
            'user_width' : self.main_widget.UserViewWidth,
            'user_height' : self.main_widget.UserViewHeight,
            'admin_width' : self.main_widget.AdminViewWidth,
            'admin_height' : self.main_widget.AdminViewHeight,
            'admin_mode' : self.main_widget.AdminMode,
            'current_view' : str(self.main_widget.UserView.viewMode()).split('.')[-1],
            'icon_slider_value' : self.main_widget.size_slider.icon_mode_value,
            'list_slider_value' : self.main_widget.size_slider.list_mode_value,
            'group_index' : self.main_widget.group_combobox.currentIndex()
        }

        with open(USER_CONFIG_PATH, 'w+') as f:
            json_str = json.dumps(user_config, indent=4)
            f.write(json_str)
```

### æ‰“å¼€æ—¶è¯»å–é…ç½®ä¿¡æ¯

&emsp;&emsp;å½“å·¥å…·å¯åŠ¨æ—¶ï¼Œå‡å¦‚ç”µè„‘æœ¬åœ°æ–‡æ¡£è·¯å¾„ä¸‹å­˜åœ¨â€œpopic_tool_config.jsonâ€æ–‡ä»¶ï¼Œåˆ™è¯»å–è¯¥æ–‡ä»¶ä¿¡æ¯å¹¶æ›´æ–°å·¥å…·æ˜¾ç¤ºï¼Œä»¥æ¢å¤ä¸å…³é—­å·¥å…·å‰ç›¸åŒçš„çŠ¶æ€ã€‚

&emsp;&emsp;å¦‚æœç”µè„‘æœ¬åœ°æ–‡æ¡£è·¯å¾„ä¸‹ä¸å­˜åœ¨â€œpopic_tool_config.jsonâ€æ–‡ä»¶ï¼Œåˆ™ä¼šä»¥é»˜è®¤é…ç½®å¯åŠ¨å·¥å…·ã€‚

```Python
class ShadowWidget(QWidget):
    def showEvent(self, event):
        super(ShadowWidget, self).showEvent(event)
        if os.path.exists(USER_CONFIG_PATH):
            with open(USER_CONFIG_PATH, 'r+') as f:
                user_config = json.load(f)
            self.move(user_config['win_left'], user_config['win_top'])
            self.main_widget.UserViewWidth = user_config['user_width']
            self.main_widget.UserViewHeight = user_config['user_height']
            self.main_widget.AdminViewWidth = user_config['admin_width']
            self.main_widget.AdminViewHeight = user_config['admin_height']
            self.main_widget.group_combobox.setCurrentIndex(user_config['group_index'])
            self.main_widget.size_slider.icon_mode_value = user_config['icon_slider_value']
            self.main_widget.size_slider.list_mode_value = user_config['list_slider_value']
            admin_mode = user_config['admin_mode']
            if admin_mode and self.main_widget.AdminView:
                pass
            else:
                if user_config['current_view'] == 'IconMode':
                    self.main_widget.change_to_icon_mode()
                elif user_config['current_view'] == 'ListMode':
                    self.main_widget.change_to_list_mode()
        self.main_widget.resize_view()

    def resize(self):
        super(ShadowWidget, self).resize(self.main_widget.width()+self.Margins + 20, self.main_widget.height()+self.Margins + 20)

class ToolWin(QMainWindow):
    def resize_view(self):
        if self.tool_view == self.AdminView:
            self.resize(self.AdminViewWidth, self.AdminViewHeight)
        else:
            self.resize(self.UserViewWidth, self.UserViewHeight)
        self.parent().resize()
```

---

## è°ƒç”¨å·¥å…·

### åœ¨ Windows ä¸‹è°ƒç”¨å·¥å…·

```Python
if __name__ == '__main__':
    app = QApplication(sys.argv)
    main_win = ToolWin()
    win = ShadowWidget(main_win)
    win.show()
    sys.exit(app.exec_())
```

### åœ¨ Maya ä¸‹è°ƒç”¨å·¥å…·

``` Python
def maya_main():
    ptr = OpenMayaUI.MQtUtil.mainWindow()
    mayaWindow = wrapInstance(long(ptr), QWidget)
    win_obj = mayaWindow.findChild(QWidget, 'popic_tool_window')
    if win_obj:
        win_obj.close()
    else:
        main_win = ToolWin()
        win_obj = ShadowWidget(main_win, mayaWindow)
        win_obj.setObjectName('popic_tool_window')
    win_obj.show()

maya_main()
```

---

## è·å– Maya çš„ Icon è·¯å¾„

&emsp;&emsp;å¾ˆå¤š Maya çš„å·¥å…·æ˜¾ç¤ºä½¿ç”¨çš„æ˜¯ Maya è‡ªå¸¦çš„å›¾æ ‡ï¼Œè¿™äº›å›¾æ ‡è·¯å¾„å¯ä»¥é€šè¿‡å‡ ä¸ªåœ°æ–¹æ‰¾åˆ°ã€‚

### XBMLANGPATH  
&emsp;&emsp;Icon è·¯å¾„ï¼Œåœ¨è¯¥å˜é‡ä¸‹çš„è·¯å¾„ä¸­çš„å›¾ç‰‡æ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨æ¥å½“ä½œç•Œé¢æ§ä»¶çš„å›¾æ ‡ã€‚  

1. è¿è¡Œ mel å‘½ä»¤ ```xbmLangPathList;``` å¯ä»¥æŸ¥çœ‹ icon è·¯å¾„ã€‚  
2. ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ç¯å¢ƒå˜é‡ ```os.environ['XBMLANGPATH']```  æŸ¥çœ‹è·¯å¾„ã€‚


